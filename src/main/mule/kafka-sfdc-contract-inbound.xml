<?xml version="1.0" encoding="UTF-8"?>

<mule xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core"
	xmlns:java="http://www.mulesoft.org/schema/mule/java" xmlns:kafka="http://www.mulesoft.org/schema/mule/kafka"
	xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd
http://www.mulesoft.org/schema/mule/kafka http://www.mulesoft.org/schema/mule/kafka/current/mule-kafka.xsd
http://www.mulesoft.org/schema/mule/java http://www.mulesoft.org/schema/mule/java/current/mule-java.xsd">
	<global-property doc:name="Global Property" doc:id="34e4b6bb-e901-4430-af89-38e22c157201" name="env" value="local" />
	<global-property doc:name="Global Property" doc:id="17fa8993-6a8c-4c62-84ba-774ee01b3bde" name="key" value="apisero" />
	<flow name="kafka-sfdc-contract-inboundFlow" doc:id="49287344-f6ba-4ac6-b002-90e42d95a477" >
		<kafka:message-listener doc:name="Message listener" doc:id="652ca685-fbea-45f6-9791-f4a0172bc4df" config-ref="Apache_Kafka_Consumer_configuration">
		</kafka:message-listener>
		<logger level="INFO" doc:name="Logger" doc:id="00110947-e466-4aaa-a2be-6cf27cd3c382" message="#[payload]"/>
		<logger level="INFO" doc:name="Log serialized input" doc:id="ee6bb5a1-480f-4c7d-a728-263813c04e1d" message='#[%dw 2.0
import * from dw::core::Binaries
output application/json
var myBinary = payload as Binary { class: "byte[]"}
---
toHex(myBinary)]'/>
<set-variable value='https://paas-schemaregistry-store.ci.aucn.io/' doc:name="Set invocation params" doc:id="f2d6a582-fe95-4255-9a94-85ccde763ed4" variableName="schemaRegistryURL" />
<java:invoke-static doc:name="Serialize Object with schema registry" doc:id="e6d89bee-9433-4124-8fcd-bfead63dbd39" class="com.auction.sfdc.contract.transform.Transformer" method="parseIncoming(byte[],java.lang.String)">
			<java:args ><![CDATA[#[{
	arg0: payload as Binary { class: "byte[]"},
	arg1: vars.schemaRegistryURL as String 
}]]]></java:args>
		</java:invoke-static>
		<ee:transform doc:name="Convert to JSON" doc:id="b8996879-e884-43d7-b3cf-c0ad92ddd0cf" >
			<ee:message >
				<ee:set-payload ><![CDATA[%dw 2.0
output application/json
---
read (payload, "application/json")]]></ee:set-payload>
			</ee:message>
		</ee:transform>
		<logger level="INFO" doc:name="Log JSON message content" doc:id="24b5c333-e2e2-4fa4-bed1-f6fc58ebab5e" message="#[payload]"/>
	</flow>
</mule>
